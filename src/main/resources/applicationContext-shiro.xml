<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"
       default-lazy-init="true">
    <!-- 继承自AuthorizingRealm的自定义Realm,即指定Shiro验证用户登录的类为自定义的ShiroDbRealm.java -->
    <bean class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
        <property name="exceptionMappings">
            <props>
                <prop key="org.apache.shiro.authz.UnauthorizedException">
                    <!--//表示捕获的异常-->
                    /unauthorized
                    <!--//捕获该异常时跳转的路径-->
                </prop>
                <prop key="org.apache.shiro.authz.UnauthenticatedException">
                    <!--//表示捕获的异常-->
                    /unauthenticated
                    <!--//捕获该异常时跳转的路径-->
                </prop>
            </props>
        </property>
    </bean>
    <!-- 定义缓存管理器 -->
    <bean id="cacheManager" class="org.apache.shiro.cache.MemoryConstrainedCacheManager" />
    <bean id="sessionManager" class="org.apache.shiro.web.session.mgt.DefaultWebSessionManager">
        <!-- session的失效时长，单位毫秒 -->
        <property name="globalSessionTimeout" value="600000"/>
        <!-- 删除失效的session -->
        <property name="deleteInvalidSessions" value="true"/>
    </bean>
    <bean id="securityManager" class="org.apache.shiro.web.mgt.DefaultWebSecurityManager">
        <property name="realms" >
            <list>
                <bean id="logAuthenticationRealm" class="com.house.security.BrokerAuthenticationRealm"/>
                <!--<bean id="logAuthorizationRealm" class="com.anjuke.security.AnjukeAuthorizationRealm"/>-->
            </list>
        </property>
        <property name="cacheManager" ref="cacheManager"></property>
        <property name="sessionManager" ref="sessionManager" />
    </bean>
    <bean name="brokerFilter" class="com.house.security.BrokerFilter"/>
    <bean id="logout" class="org.apache.shiro.web.filter.authc.LogoutFilter">
        <property name="redirectUrl" value="${sso.logoutUrl}" />
    </bean>
    <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">
        <property name="loginUrl" value="/ssologin"></property>
        <property name="filters">
            <map>
                <entry key="authc" value-ref="anjuke58SSOFilter"/>
                <entry key="logout" value-ref="logout"/>
            </map>
        </property>

        <property name="unauthorizedUrl" value="/unauthorized"/>
        <property name="securityManager" ref="securityManager"/>
         <property name="filterChainDefinitions" >
            <value>
                /ssologin=authc
                /logout=logout
                /man/**=roles[manager]
                /common/**=anon
                /**=roles[user]

            </value>
        </property>
    </bean>
    <bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor"/>
</beans>